<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="When using Traefik as your Kubernetes ingress controller you might want to redirect any requests to your top-level domain (for instance my-domain.com) to its WWW variant (www.my-domain.com). You can use this snippet to create a Traefik IngressRoute and Traefik Middleware that will do just that.
Prerequisites A running instance of Traefik v2 in a Kubernetes cluster kubectl access to the Kubernetes cluster External IP address of the server/VM for testing Snippet apiVersion: traefik."><meta name=theme-color content="#ec7067"><meta property="og:title" content="Traefik: non-WWW to WWW redirect • Nerdieworks"><meta property="og:description" content="When using Traefik as your Kubernetes ingress controller you might want to redirect any requests to your top-level domain (for instance my-domain.com) to its WWW variant (www.my-domain.com). You can use this snippet to create a Traefik IngressRoute and Traefik Middleware that will do just that.
Prerequisites A running instance of Traefik v2 in a Kubernetes cluster kubectl access to the Kubernetes cluster External IP address of the server/VM for testing Snippet apiVersion: traefik."><meta property="og:url" content="https://nerdieworks.nl/posts/traefik-non-www-to-www-redirect/"><meta property="og:site_name" content="Nerdieworks"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:tag" content="traefik"><meta property="article:tag" content="tutorial"><meta property="article:tag" content="snippet"><meta property="article:published_time" content="2022-06-07T21:55:36+02:00"><meta property="article:modified_time" content="2022-06-07T21:55:36+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.100.1"><title>Traefik: non-WWW to WWW redirect • Nerdieworks</title><link rel=canonical href=https://nerdieworks.nl/posts/traefik-non-www-to-www-redirect/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ec7067}</style></head><body class='page type-posts has-sidebar'><div class=site><div id=sidebar class=sidebar><a class=screen-reader-text href=#main-menu>Skip to Main Menu</a><div class=container><section class='widget widget-about sep-after'><header><div class=logo><a href=/><img src=/images/logo.png></a></div><h2 class='title site-title'><a href=/>Nerdieworks</a></h2><div class=desc>DevOps babble</div></header></section><section class='widget widget-sidebar_menu sep-after'><nav id=sidebar-menu class='menu sidebar-menu' aria-label='Sidebar Menu'><div class=container><ul><li class=item><a href=/>Home</a></li><li class='item has-current'><a href=/posts/>Posts</a></li></ul></div></nav></section><section class='widget widget-taxonomy_cloud sep-after'><header><h4 class='title widget-title'>Tags</h4></header><div class='container list-container'><ul class='list taxonomy-cloud'><li><a href=/tags/security/ style=font-size:1em>security</a></li><li><a href=/tags/snippet/ style=font-size:2em>snippet</a></li><li><a href=/tags/traefik/ style=font-size:2em>traefik</a></li><li><a href=/tags/tutorial/ style=font-size:2em>tutorial</a></li></ul></div></section></div><div class=sidebar-overlay></div></div><div class=main><a class=screen-reader-text href=#content>Skip to Content</a>
<button id=sidebar-toggler class=sidebar-toggler aria-controls=sidebar>
<span class=screen-reader-text>Toggle Sidebar</span>
<span class=open><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></span><span class=close><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></span></button><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class='widget widget-breadcrumbs sep-after'><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/posts/>Posts</a></li><li><span>Traefik: non-WWW to WWW redirect</span></li></ol></nav></section></div></div><header id=header class='header site-header'><div class='container sep-after'><div class=header-info><p class='site-title title'>Nerdieworks</p><p class='desc site-desc'>DevOps babble</p></div></div></header><main id=content><article lang=en class=entry><header class='header entry-header'><div class='container sep-after'><div class=header-info><h1 class=title>Traefik: non-WWW to WWW redirect</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2022-06-07T21:55:36+02:00>2022, June 7</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>One min read</span></div></div></header><div class='container entry-content'><p>When using <a href=https://doc.traefik.io/>Traefik</a> as your <a href=https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/>Kubernetes ingress controller</a> you might want to redirect any requests to your top-level domain (for instance <code>my-domain.com</code>) to its WWW variant (<code>www.my-domain.com</code>). You can use this snippet to create a <a href=https://doc.traefik.io/traefik/routing/providers/kubernetes-crd/>Traefik IngressRoute</a> and <a href=https://doc.traefik.io/traefik/middlewares/http/redirectscheme/>Traefik Middleware</a> that will do just that.</p><h2 id=prerequisites>Prerequisites</h2><ul><li>A running instance of Traefik v2 in a Kubernetes cluster</li><li><code>kubectl</code> access to the Kubernetes cluster</li><li>External IP address of the server/VM for testing</li></ul><h2 id=snippet>Snippet</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>IngressRoute</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-domain-com-www-redirect</span> <span style=color:#75715e># Change this</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span> <span style=color:#75715e># Change this?</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>entryPoints</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>websecure</span> <span style=color:#75715e># Change this?</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>routes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Rule</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>match</span>: <span style=color:#ae81ff>Host(`my-domain.com`)</span> <span style=color:#75715e># Change this</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>middlewares</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redirect-to-www</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>traefik</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>TraefikService</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>noop@internal</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Middleware</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redirect-to-www</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>traefik</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>redirectRegex</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>permanent</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#34;^https?://(?:www\\.)?(.+)&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>replacement</span>: <span style=color:#e6db74>&#34;https://www.${1}&#34;</span>
</span></span></code></pre></div><h2 id=usage>Usage</h2><ol><li><p>Save the snippet above to a file called <code>my-domain-com-www-redirect.yaml</code>. <a href=/resources/my-domain-com-www-redirect.yaml>You can download it here</a></p></li><li><p>Make the necessary changes</p></li><li><p>Create the resources:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f my-domain-com-www-redirect.yaml
</span></span></code></pre></div></li><li><p>Try it out with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -v https://my-domain.com/ --resolve my-domain.com:443:<span style=color:#f92672>{</span>your server IP<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 301 Moved Permanently</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Location: https://www.my-domain.com/</span>
</span></span></code></pre></div></li></ol><h2 id=notes>Notes</h2><p>In case you&rsquo;ve enabled the <code>providers.kubernetesCRD.ingressClass</code> in the static configuration, you will have to add the <a href=https://doc.traefik.io/traefik/providers/kubernetes-crd/#ingressclass><code>kubernetes.io/ingress.class</code></a> annotation to the <code>IngressRoute</code>.</p></div><footer class=entry-footer><div class='container sep-before'><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/traefik/>traefik</a>, <a class=tag href=/tags/tutorial/>tutorial</a>, <a class=tag href=/tags/snippet/>snippet</a></div></div></footer></article><nav class=entry-nav><div class=container><div class='prev-entry sep-before'><a href=/posts/traefik-default-http-to-https-redirect/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Traefik: default HTTP to HTTPS redirect</a></div><div class='next-entry sep-before'><a href=/posts/traefik-add-trailing-slash/><span class=screen-reader-text>Next post: </span>Traefik: add trailing slash<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class='container sep-before'><section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'><ul><li><a href=https://github.com/Nerdieworks target=_blank rel='noopener me'><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=mailto:maurits@nerdieworks.nl target=_blank rel='noopener me'><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/mauritsvanmastrigt target=_blank rel='noopener me'><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li><li><a href=https://t.me/mauvm target=_blank rel='noopener me'><span class=screen-reader-text>Open Telegram account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23.91 3.79 20.3 20.84c-.25 1.21-.98 1.5-2 .94l-5.5-4.07-2.66 2.57c-.3.3-.55.56-1.1.56-.72.0-.6-.27-.84-.95L6.3 13.7.85 12c-1.18-.35-1.19-1.16.26-1.75l21.26-8.2c.97-.43 1.9.24 1.53 1.73z"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2019-2022 Maurits van Mastrigt</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script></body></html>